{% extends 'base.html' %}

{% block content %}
  <h1>Quiz Results</h1>
  <table>
    <thead>
      <tr>
        <th style="text-align: center;">Quiz  </th>
        <th style="text-align: center;">User  </th>
        <th stylestyle="text-align: center;">Percentage Score  </th>
      </tr>
    </thead>
    <tbody>
      {% for result in grouped_results %}
        {% if user.is_teacher %}
          <tr>
            <td style="text-align: center;">{{ result.quiz_title }}</td>
            <td style="text-align: center;">{{ result.user.username }}</td>
            <td style="text-align: center;"> {{ result.percentage_score }}%</td>
            <td style="text-align: center;">
              <button class="btn btn-dark" onclick="toggleQuestions(this)">Show Questions</button>
              <div class="questions" style="display: none;">
                <h2>Questions:</h2>
                <ul>
                  {% for question_result in result.questions %}
                    <li>{{ question_result.question_text }}: {{ question_result.is_correct }}</li>
                  {% endfor %}
                </ul>
              </div>
            </td>
          </tr>
        {% else %}
          {% if result.user == user %}
          <tr>
            <td style="text-align: center; vertical-align: top;">{{ result.quiz_title }}</td>
            <td style="text-align: center; vertical-align: top;">{{ result.user.username }}</td>
            <td style="text-align: center; vertical-align: top;"> {{ result.percentage_score }}%</td>
            <td style="text-align: center;">
              <button class="btn btn-dark" onclick="toggleQuestions(this)">Show Questions</button>
              <div class="questions" style="display: none;">
                <ul>
                  {% for question_result in result.questions %}
                    <li>{{ question_result.question_text }}: {{ question_result.is_correct }}</li>
                  {% endfor %}
                </ul>
              </div>
            </td>
          </tr>
          {% endif %}
        {% endif %}
      {% endfor %}
    </tbody>
  </table>

  <script>
    function toggleQuestions(button) {
      var questionsDiv = button.nextElementSibling;
      if (questionsDiv.style.display === "none") {
        questionsDiv.style.display = "block";
      } else {
        questionsDiv.style.display = "none";
      }
    }
  </script>
{% endblock %}
